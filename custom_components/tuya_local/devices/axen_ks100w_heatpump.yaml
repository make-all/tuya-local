# Most DPS above 128 not implemented, as they do not appear in the log
# see #2561 for details if they show up in future.
name: Combo heat pump
products:
  - id: l01fseshej0xmz8x
    manufacturer: Axen
    model: KS-100W/EN8BP
entities:
  - entity: switch
    category: config
    dps:
      - id: 1
        type: boolean
        name: switch
  - entity: binary_sensor
    class: problem
    name: Errors
    category: diagnostic
    dps:
      - id: 6
        type: bitfield
        name: sensor
        mapping:
          - dps_val: 0
            value: false
          - value: true
      - id: 6
        type: bitfield
        name: fault_code
  - entity: switch
    name: Silent mode
    icon: "mdi:volume-mute"
    icon_priority: 2
    category: config
    dps:
      - id: 101
        type: boolean
        name: switch
        mapping:
          - dps_val: false
            icon: "mdi:volume-high"
            icon_priority: 1
  - entity: climate
    dps:
      - id: 1
        type: boolean
        name: available
      - id: 102
        type: integer
        name: cool_temperature
        range:
          min: 70
          max: 250
        mapping:
          - scale: 10
            step: 10
      - id: 103
        type: integer
        name: temperature
        unit: C
        range:
          min: 250
          max: 650
        mapping:
          - scale: 10
            step: 10
            constraint: hvac_mode
            conditions:
              - dps_val: ["cool", "cool_hot_water"]
                value_redirect: cool_temperature
                range:
                  min: 70
                  max: 250
              - dps_val: ["auto", "auto_dhw"]
                value_redirect: auto_temperature
                range:
                  min: 70
                  max: 600
      - id: 105
        type: integer
        optional: true
        name: auto_temperature
        range:
          min: 70
          max: 600
        mapping:
          - scale: 10
            step: 10
      - id: 109
        type: string
        name: water_off
        hidden: true
        mapping:
          - dps_val: cool
            value: true
          - dps_val: heat
            value: true
          - dps_val: auto
            value: true
          - value: false
      - id: 109
        type: string
        name: water_on
        hidden: true
        mapping:
          - dps_val: cool
            value: false
          - dps_val: heat
            value: false
          - dps_val: auto
            value: false
          - value: true
      - id: 109
        type: string
        name: hvac_mode
        mapping:
          - dps_val: cool
            value: cool
            available: water_off
          - dps_val: heat
            value: heat
            available: water_off
          - dps_val: auto
            value: heat_cool
            available: water_off
          - dps_val: hot_water
            value: "off"
            available: water_on
          - dps_val: cool_hot_water
            value: cool
            available: water_on
          - dps_val: heat_hot_water
            value: heat
            available: water_on
          - dps_val: auto_dhw
            value: auto
            available: water_on
      - id: 165
        type: boolean
        optional: true
        name: away_mode
        mapping:
          - dps_val: null
            value: false
            hidden: true

  - entity: water_heater
    name: Water heater
    dps:
      - id: 1
        type: boolean
        name: operation_mode
        # FIXME: selected mode reverts to the original setting, while
        # modifying the DPS 109 directly works.
        # It follows the setting made in another instance/Tuya app though
        mapping:
          - dps_val: false
            value: "off"
          - dps_val: true
            constraint: work_mode
            conditions:
              - dps_val: cool
                value: Cooling
              - dps_val: heat
                value: Heating
              - dps_val: auto
                value: Auto
              - dps_val: hot_water
                value: Hot water
              - dps_val: cool_hot_water
                value: Hot water and cooling
              - dps_val: heat_hot_water
                value: Hot water and heating
              - dps_val: auto_dhw
                value: Auto and hot water
      - id: 104
        type: integer
        name: temperature
        unit: C
        range:
          min: 250
          max: 600
        mapping:
          - scale: 10
            step: 10
      - id: 108
        type: integer
        name: current_temperature
        mapping:
          - scale: 10
      - id: 109
        type: string
        name: work_mode
        hidden: true
      - id: 165
        type: boolean
        optional: true
        name: away_mode
        mapping:
          - dps_val: null
            value: false
            hidden: true
  # Added because of the above problem in the water_heater operation_mode
  - entity: select
    name: Operation mode
    category: config
    dps:
      - id: 109
        type: string
        name: option
        mapping:
          - dps_val: cool
            value: Cool
          - dps_val: heat
            value: Heat
          - dps_val: auto
            value: Auto
          - dps_val: hot_water
            value: Hot water
          - dps_val: cool_hot_water
            value: Cool + Hot Water
          - dps_val: heat_hot_water
            value: Heat + Hot Water
          - dps_val: auto_dhw
            value: Auto + Hot Water
  - entity: sensor
    name: Inlet temperature
    class: temperature
    dps:
      - id: 106
        type: integer
        name: sensor
        unit: C
        class: measurement
        mapping:
          - scale: 10
  - entity: sensor
    name: Outlet temperature
    class: temperature
    dps:
      - id: 107
        type: integer
        name: sensor
        unit: C
        class: measurement
        mapping:
          - scale: 10
  - entity: binary_sensor
    name: Protection
    class: running
    category: diagnostic
    dps:
      - id: 110
        type: boolean
        optional: true
        name: sensor
  - entity: binary_sensor
    name: Frost protection
    class: running
    category: diagnostic
    icon: "mdi:snowflake-off"
    dps:
      - id: 114
        type: boolean
        name: sensor
  - entity: binary_sensor
    name: Defrosting
    class: running
    category: diagnostic
    icon: "mdi:snowflake-melt"
    dps:
      - id: 115
        type: boolean
        name: sensor
  - entity: binary_sensor
    name: 4-way valve
    class: running
    category: diagnostic
    icon: "mdi:valve"
    dps:
      - id: 117
        name: sensor
        type: boolean
  - entity: binary_sensor
    name: Water pump
    class: running
    category: diagnostic
    icon: "mdi:pump"
    dps:
      - id: 116
        type: boolean
        name: sensor
  - entity: sensor
    name: Ambient temperature
    class: temperature
    icon: "mdi:home-thermometer-outline"
    dps:
      - id: 118
        type: integer
        name: sensor
        unit: C
        mapping:
          - scale: 10
        class: measurement
  - entity: sensor
    name: Discharge temperature
    class: temperature
    category: diagnostic
    dps:
      - id: 119
        type: integer
        name: sensor
        unit: C
        class: measurement
        mapping:
          - scale: 10
  - entity: sensor
    name: Suction temperature
    class: temperature
    category: diagnostic
    dps:
      - id: 120
        type: integer
        name: sensor
        unit: C
        class: measurement
        mapping:
          - scale: 10
  - entity: sensor
    name: Compressor frequency
    class: frequency
    category: diagnostic
    dps:
      - id: 121
        type: integer
        name: sensor
        unit: Hz
        class: measurement
  - entity: sensor
    name: Main valve opening
    category: diagnostic
    dps:
      - id: 122
        type: integer
        name: sensor
        unit: "Step"
        range:
          min: 0
          max: 480
        class: measurement
  - entity: sensor
    name: Auxiliary valve opening
    category: diagnostic
    dps:
      - id: 123
        type: integer
        name: sensor
        unit: "Step"
        range:
          min: 0
          max: 480
        class: measurement
  - entity: sensor
    name: AC Fan
    icon: "mdi:fan-auto"
    class: enum
    category: diagnostic
    dps:
      - id: 124
        type: string
        name: sensor
        mapping:
          - dps_val: close
            value: Closed
            icon: "mdi:fan-off"
          - dps_val: low_spd
            value: Low speed
            icon: "mdi:fan-speed-1"
          - dps_val: high_spd
            value: High speed
            icon: "mdi:fan-speed-2"
  - entity: sensor
    name: DC fan 1
    icon: "mdi:fan-speed-1"
    category: diagnostic
    dps:
      - id: 125
        type: integer
        name: sensor
        unit: rpm
        class: measurement
  - entity: sensor
    name: DC fan 2
    icon: "mdi:fan-speed-2"
    category: diagnostic
    dps:
      - id: 126
        type: integer
        name: sensor
        unit: rpm
        class: measurement
  - entity: sensor
    name: Water flow rate
    icon: "mdi:water-percent"
    class: volume_flow_rate
    category: diagnostic
    dps:
      - id: 127
        type: integer
        name: sensor
        unit: mÂ³/h
        class: measurement
        mapping:
          - scale: 10
  - entity: sensor
    name: AC Voltage
    class: voltage
    dps:
      - id: 128
        type: integer
        name: sensor
        unit: V
  - entity: sensor
    name: AC Current
    class: current
    dps:
      - id: 129
        type: integer
        name: sensor
        unit: A
        mapping:
          - scale: 10
  # TODO: Find out exactly how the fault is reported
  - entity: binary_sensor
    name: Fault flag
    class: problem
    dps:
      - id: 130
        name: sensor
        type: boolean

  # User configurable operating temperature values
  - entity: number
    name: Auto mode heating temperature for zone 1
    mode: box
    class: temperature
    category: config
    dps:
      - id: 158
        type: integer
        name: value
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
            step: 10
  - entity: number
    name: Cooling temperature for zone 2
    mode: box
    class: temperature
    category: config
    dps:
      - id: 160
        type: integer
        name: value
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
            step: 10
  - entity: number
    name: Heating temperature for zone 2
    mode: box
    class: temperature
    category: config
    dps:
      - id: 161
        type: integer
        name: value
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
            step: 10
  - entity: number
    name: Auto mode cooling temperature for zone 2
    mode: box
    class: temperature
    category: config
    dps:
      - id: 162
        type: integer
        name: value
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
            step: 10
  - entity: number
    name: Auto mode heating temperature for zone 2
    mode: box
    class: temperature
    category: config
    dps:
      - id: 163
        type: integer
        name: value
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
            step: 10
  - entity: number
    name: Indoor room temperature
    mode: box
    class: temperature
    category: config
    dps:
      - id: 164
        type: integer
        name: value
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
            step: 10

  # TODO: Figure out the meaning
  # - entity: select
  #   name: Automatic mode target running status
  #   dps:
  #     - id: 180
  #       type: integer
  #       name: option
  #       mapping:
  #         - dps_val: 0
  #           value: "0"
  #         - dps_val: 1
  #           value: "1"

  # Below items are reported by the device.
  # They might not provide useful information to the user
  # and could be hidden by default.

  # According to the protocol query, this DPS is read-write, but when the
  # pump is operating, it reverts to the values it receives as an input.
  # It might actually do something depending on the configuration of DPS 12,
  # room thermostat type.
  # Make it read-only for
  - entity: sensor
    name: Active zones
    class: enum
    dps:
      - id: 159
        type: integer
        name: sensor
        mapping:
          - dps_val: 0
            value: "None"
          - dps_val: 1
            value: "Zone 1"
            icon: "mdi:home-floor-1"
          - dps_val: 2
            value: "Zone 2"
            icon: "mdi:home-floor-2"
          - dps_val: 3
            value: "Zone 1 & 2"
            icon: "mdi:home"
  # TODO: Find the meaning of the values and provide a user friend description
  - entity: sensor
    name: Valid mode
    class: enum
    dps:
      - id: 131
        type: string
        name: sensor
        mapping:
          - dps_val: 0
            value: "0"
          - dps_val: 1
            value: "1"
          - dps_val: 2
            value: "2"
          - dps_val: 3
            value: "3"
          - dps_val: 4
            value: "4"
          - dps_val: 5
            value: "5"
          - dps_val: 6
            value: "6"
          - dps_val: 7
            value: "7"

  # Temperature limit values
  - entity: sensor
    name: Maximum cooling temperature in zone 1
    class: temperature
    dps:
      - id: 132
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Minimum cooling temperature in zone 1
    class: temperature
    dps:
      - id: 133
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Maximum heating temperature in zone 1
    class: temperature
    dps:
      - id: 134
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Minimum heating temperature in zone 1
    class: temperature
    dps:
      - id: 135
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Maximum temperature for heater water
    icon: "mdi:thermometer-chevron-up"
    class: temperature
    dps:
      - id: 136
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Minimum temperature for heater water
    icon: "mdi:thermometer-chevron-down"
    class: temperature
    dps:
      - id: 137
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10

  - entity: sensor
    name: Maximum cooling temperature in auto mode in zone 1
    class: temperature
    dps:
      - id: 138
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10

  - entity: sensor
    name: Minimum cooling temperature in auto mode in zone 1
    class: temperature
    dps:
      - id: 139
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Maximum heating temperature in auto mode in zone 1
    class: temperature
    dps:
      - id: 140
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Minimum heating temperature in auto mode in zone 1
    class: temperature
    dps:
      - id: 141
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Maximum cooling temperature in zone 2
    class: temperature
    dps:
      - id: 142
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Minimum cooling temperature in zone 2
    class: temperature
    dps:
      - id: 143
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Maximum heating temperature in zone 2
    class: temperature
    dps:
      - id: 144
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Minimum heating temperature in zone 2
    class: temperature
    dps:
      - id: 145
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Maximum cooling temperature in auto mode in zone 2
    class: temperature
    dps:
      - id: 146
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Minimum cooling temperature in auto mode in zone 2
    class: temperature
    dps:
      - id: 147
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Maximum heating temperature in auto mode in zone 2
    class: temperature
    dps:
      - id: 148
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Minimum heating temperature in auto mode in zone 2
    class: temperature
    dps:
      - id: 149
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Maximum room temperature
    class: temperature
    dps:
      - id: 150
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10
  - entity: sensor
    name: Minimum room temperature
    class: temperature
    dps:
      - id: 151
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10

  # Indoor means the room where the internal unit is located
  - entity: sensor
    name: Indoor temperature
    class: temperature
    dps:
      - id: 181
        type: integer
        name: sensor
        unit: C
        range:
          min: 0
          max: 1000
        mapping:
          - scale: 10

  # Heat pump zone room thermostat configuration
  - entity: sensor
    name: Thermostat type
    class: enum
    dps:
      - id: 152
        type: integer
        name: sensor
        mapping:
          - dps_val: 0
            value: "Without room thermostat"
          - dps_val: 1
            value: "Configured mode"
          - dps_val: 2
            value: "Single zone"
          - dps_val: 3
            value: "Dual zone"

  # TODO: Figure out the meaning of the values
  - entity: sensor
    name: Whether to partition when there is no thermostat
    class: enum
    dps:
      - id: 153
        type: integer
        name: sensor
        mapping:
          - dps_val: 0
            value: "0"
          - dps_val: 1
            value: "1"
  - entity: sensor
    name: Single zone operation mode without thermostat
    class: enum
    dps:
      - id: 154
        type: integer
        name: sensor
        mapping:
          - dps_val: 0
            value: "Manual setting"
          - dps_val: 1
            value: "Weather curve"
          - dps_val: 2
            value: "Reserved"
          - dps_val: 3
            value: "Room temperature"
  - entity: sensor
    name: Dual-zone operation mode without thermostat
    class: enum
    dps:
      - id: 155
        type: integer
        name: sensor
        mapping:
          - dps_val: 0
            value: "Manual setting"
          - dps_val: 1
            value: "Zone 1 manual setting / Zone 2 weather curve"
          - dps_val: 2
            value: "Reserved"
          - dps_val: 3
            value: "Zone 1 manual setting / Zone 2 real weather curve"
          - dps_val: 4
            value: "Zone 1 room temperature / Zone 2 manual setting"
          - dps_val: 5
            value: "Weather curve"
          - dps_val: 6
            value: "Reserved"
          - dps_val: 7
            value: "Zone 1 weather curve / Zone 2 room temperature"
  # TODO: This needs a double check as the manual is not clear:
  # 0 = SET MODE, 1 = ONE ZONE
  - entity: sensor
    name: Single zone operation mode with thermostat
    class: enum
    dps:
      - id: 156
        type: integer
        name: sensor
        mapping:
          - dps_val: 0
            value: "Manual setting"
          - dps_val: 1
            value: "Room temperature"
  # TODO: This needs a double check as the manual is not clear.
  # It contains : target temperature for ROOM THERMOSTAT = TWO ZONES
  - entity: sensor
    name: Dual-zone operation mode with thermostat
    class: enum
    dps:
      - id: 157
        type: integer
        name: sensor
        mapping:
          - dps_val: 0
            value: "0"
          - dps_val: 1
            value: "1"
          - dps_val: 2
            value: "2"
          - dps_val: 3
            value: "3"
